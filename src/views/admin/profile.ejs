<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('./partials/head') %>
  <style>
    #new-films-upload .recent-product-img {
      width: 54px;
      height: 70px;
      border-radius: 6px;
    }

    #new-films-upload .recent-product-img img {
      width: 100%;
      height: 100%;
      padding: 1px;
      border-radius: 6px;
    }

    #new-user-register .recent-product-img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
    }

    #new-user-register .recent-product-img img {
      width: 100%;
      height: 100%;
      padding: 2px;
      border-radius: 50%;
    }

    .modal-content {
      background-image: radial-gradient(circle at 17% 1%, rgba(198, 198, 198, .03) 0, rgba(198, 198, 198, .03) 50%, rgba(42, 42, 42, .03) 50%, rgba(42, 42, 42, .03) 100%), radial-gradient(circle at 8% 81%, rgba(253, 253, 253, .03) 0, rgba(253, 253, 253, .03) 50%, rgba(36, 36, 36, .03) 50%, rgba(36, 36, 36, .03) 100%), radial-gradient(circle at 83% 29%, rgba(164, 164, 164, .03) 0, rgba(164, 164, 164, .03) 50%, rgba(60, 60, 60, .03) 50%, rgba(60, 60, 60, .03) 100%), radial-gradient(circle at 96% 62%, rgba(170, 170, 170, .03) 0, rgba(170, 170, 170, .03) 50%, rgba(169, 169, 169, .03) 50%, rgba(169, 169, 169, .03) 100%), linear-gradient(338deg, #028DD5, #05AC51);
    }
  </style>
</head>

<body class="bg-theme bg-theme13">
  <!--wrapper-->
  <div class="wrapper">
    <!--sidebar wrapper -->
    <%- include('./partials/sidebar') %>
    <!--end sidebar wrapper -->
    <!--start header -->
    <%- include('./partials/header') %>
    <!--end header -->
    <!--start page wrapper -->
    <div class="page-wrapper">
      <div class="page-content">
        <div class="row">
          <div class="col-lg-4">
            <div class="card">
              <div class="card-body">
                <div class="d-flex flex-column align-items-center text-center">
                  <img src="<%=user.avatar%>" alt="Admin" class="rounded-circle p-1 bg-primary" width="110">
                  <div class="mt-3">
                    <h4><%=user.name%></h4>
                    <% if(user.level === 0) { %>
                    <span class="badge text-white bg-gradient-lush text-uppercase px-3 mb-2">Admin</span>
                    <% } else { %>
                    <span class="badge text-white bg-gradient-blues text-uppercase px-3 mb-2">Poster</span>
                    <% } %>
                    <p class="font-size-sm mb-1">Created At: <%=user.createdAt.substring(0, 10)%></p>
                    <p class="font-size-sm mb-4">Updated At: <%=user.updatedAt.substring(0, 10)%></p>
                    <button class="btn btn-light" style="font-size:0.8rem;"><i class="bx bx-box me-1"></i>Box
                      Film</button>
                    <button class="btn btn-light" style="font-size:0.8rem;"><i
                        class="bx bx-comment-detail me-1"></i>Recent Comment</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-8">
            <div class="card">
              <div class="card-body">
                <form id="form-info">
                  <div class="row mb-3">
                    <div class="col-sm-3">
                      <h6 class="mb-0">User Name</h6>
                    </div>
                    <div class="col-sm-9">
                      <input type="text" class="form-control" name="name" value="<%=user.name%>" required />
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Email</h6>
                    </div>
                    <div class="col-sm-9">
                      <input type="email" class="form-control" name="email" value="<%=user.email%>" required />
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-sm-3">
                      <h6 class="mb-0">User Avatar</h6>
                    </div>
                    <div class="col-sm-9">
                      <input type="text" class="form-control" name="avatar" value="<%=user.avatar%>" required />
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Membership</h6>
                    </div>
                    <div class="col-sm-9">
                      <select class="form-control" name="level" required>
                        <option <%= user.level===0 ? 'selected' : '' %> value="0">Admin</option>
                        <option <%= user.level===1 ? 'selected' : '' %> value="1">Poster</option>
                        <option <%= user.level===2 ? 'selected' : '' %> value="2">Member</option>
                      </select>
                    </div>
                  </div>
                  <input type="text" name="user_id" style="display:none;" value="<%=user._id.toString()%>">
                  <div class="row">
                    <div class="col-sm-3"></div>
                    <div class="col-sm-9">
                      <button type="button" class="btn btn-light px-4 btn-change-info">Save Changes</button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
            <div class="card">
              <div class="card-body">
                <form id="form-password">
                  <div class="row mb-3">
                    <div class="col-sm-3">
                      <h6 class="mb-0">Change Password</h6>
                    </div>
                    <div class="col-sm-9">
                      <input type="text" class="form-control" name="password" required />
                    </div>
                    <input type="text" name="user_id" style="display:none;" value="<%=user._id.toString()%>">
                  </div>
                  <div class="row">
                    <div class="col-sm-3"></div>
                    <div class="col-sm-9">
                      <button type="button" class="btn btn-light px-4 btn-change-password">Change</button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--end page wrapper -->
    <!--start overlay-->
    <div class="overlay toggle-icon"></div>
    <!--end overlay-->
    <!--Start Back To Top Button--><a href="javaScript:;" class="back-to-top"><i class="bx bxs-up-arrow-alt"></i></a>
    <!--End Back To Top Button-->
    <%- include('./partials/footer') %>
  </div>
  <!--end wrapper-->
  <!-- Start Javascript Import -->
  <%- include('./partials/javascript-import') %>
  <script>
    const formInfo = document.querySelector('#form-info');
    const formPassword = document.querySelector('#form-password');
    const btnChangeInfo = document.querySelector('.btn-change-info');
    const btnChangePassWord = document.querySelector('.btn-change-password');

    // Handle submit change info
    if (btnChangeInfo) btnChangeInfo.onclick = function () {
      const {
        user_id,
        ...dataForm
      } = Object.fromEntries(new FormData(formInfo));
      $.ajax({
        type: 'PATCH',
        url: '/admin/users/update/' + user_id,
        data: dataForm,
      }).done(() => {
        console.log(dataForm, user_id)
        location.reload();
      });
    }

    // Handle submit change password
    if (btnChangePassWord) btnChangePassWord.onclick = function () {
      const {
        user_id,
        ...dataForm
      } = Object.fromEntries(new FormData(formPassword));
      $.ajax({
        type: 'PATCH',
        url: '/admin/users/update/' + user_id,
        data: dataForm,
      }).done(() => {
        location.reload();
      });
    }
  </script>
  <!-- End Javascript Import -->
</body>

</html>